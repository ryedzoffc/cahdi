<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBT Pengetahuan Umum SMP Level Mudah</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #3498db;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #1a252f;
        }
        
        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            max-width: 500px;
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .dashboard, .test-container, .result-container, .admin-panel {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .user-profile {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .rules {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .rule-list {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .timer {
            position: sticky;
            top: 0;
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 1.2rem;
            z-index: 100;
        }
        
        .question {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .options {
            margin-top: 15px;
        }
        
        .option {
            margin-bottom: 10px;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .score-display {
            font-size: 2rem;
            text-align: center;
            margin: 20px 0;
            color: #2c3e50;
        }
        
        .answer-analysis {
            margin-top: 30px;
        }
        
        .correct {
            color: #27ae60;
        }
        
        .incorrect {
            color: #e74c3c;
        }
        
        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #3498db;
            color: white;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: #ddd;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .tab-btn.active {
            background-color: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .btn-container {
                flex-direction: column;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Halaman Utama -->
        <header id="home-page">
            <h1>CBT Pengetahuan Umum SMP Level Mudah</h1>
            <p class="description">Selamat datang di platform CBT matematika SMP Negeri 6 Amlapura. Selamat Mengerjakan!</p>
            <div class="btn-container">
                <button class="btn" id="participant-login-btn">Login Sebagai Peserta</button>
                <button class="btn" id="admin-login-btn">Login Sebagai Admin</button>
            </div>
        </header>

        <!-- Form Login Peserta -->
        <div class="login-form" id="participant-login">
            <h2>Login Peserta</h2>
            <div class="form-group">
                <label for="participant-name">Nama</label>
                <input type="text" id="participant-name" placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group">
                <label for="participant-email">Email</label>
                <input type="email" id="participant-email" placeholder="Masukkan email">
            </div>
            <div class="form-group">
                <label for="participant-password">Password</label>
                <input type="password" id="participant-password" placeholder="Masukkan password">
            </div>
            <button class="btn" id="participant-login-submit">Login</button>
            <button class="btn" style="background-color: #7f8c8d;" id="back-to-home">Kembali</button>
        </div>

        <!-- Form Login Admin -->
        <div class="login-form" id="admin-login">
            <h2>Login Admin</h2>
            <div class="form-group">
                <label for="admin-email">Email</label>
                <input type="email" id="admin-email" placeholder="Masukkan email admin">
            </div>
            <div class="form-group">
                <label for="admin-password">Password</label>
                <input type="password" id="admin-password" placeholder="Masukkan password admin">
            </div>
            <button class="btn" id="admin-login-submit">Login</button>
            <button class="btn" style="background-color: #7f8c8d;" id="back-to-home-admin">Kembali</button>
        </div>

        <!-- Dashboard Peserta -->
        <div class="dashboard" id="dashboard">
            <button class="logout-btn" id="logout-participant">Logout</button>
            <div class="user-profile">
                <h2>Profil Pengguna</h2>
                <p><strong>Nama:</strong> <span id="profile-name"></span></p>
                <p><strong>Email:</strong> <span id="profile-email"></span></p>
                <p><strong>Kelas:</strong> <span id="profile-class"></span></p>
                <p><strong>Asal Sekolah:</strong> <span id="profile-school"></span></p>
            </div>
            
            <div class="rules">
                <h2>Keterangan Lomba</h2>
                <ol class="rule-list">
                    <li>Waktu Pengerjaan: Pastikan Anda memahami waktu yang diberikan untuk mengerjakan soal. Waktu pengerjaan adalah 120 menit.</li>
                    <li>Jumlah Soal: Terdapat 40 soal yang harus dikerjakan dalam waktu yang ditentukan.</li>
                    <li>Pilih Jawaban: Pilih jawaban yang paling tepat untuk setiap soal.</li>
                    <li>Navigasi: Anda dapat berpindah antar soal menggunakan tombol navigasi yang disediakan.</li>
                    <li>Pengiriman Jawaban: Setelah selesai, klik tombol "Kirim" untuk mengirimkan jawaban Anda.</li>
                    <li>Koneksi Internet: Pastikan koneksi internet Anda stabil selama pengerjaan soal.</li>
                    <li>Tidak Ada Diskusi: Anda tidak diperbolehkan berdiskusi dengan peserta lain.</li>
                    <li>Tidak Ada Bantuan: Anda tidak diperbolehkan menggunakan bantuan lain seperti buku atau catatan.</li>
                    <li>Periksa Jawaban: Pastikan Anda telah memeriksa semua jawaban Anda sebelum mengirim.</li>
                    <li>Kepatuhan: Pastikan Anda mematuhi semua peraturan yang diberikan.</li>
                </ol>
                <p><strong>Format Jawaban:</strong> Pilihan ganda dengan 4 opsi (A, B, C, D)</p>
                <p><strong>Tingkat Kesulitan:</strong> Soal-soal level mudah, namun tetap fokus dan teliti.</p>
            </div>
            
            <button class="btn" id="start-test">Mulai Tes</button>
        </div>

        <!-- Halaman Tes -->
        <div class="test-container" id="test-container">
            <button class="logout-btn" id="logout-during-test">Logout</button>
            <div class="timer" id="timer">
                Waktu tersisa: 120:00
            </div>
            
            <div id="questions-container">
                <!-- Soal akan dimuat di sini melalui JavaScript -->
            </div>
            
            <div class="navigation">
                <button class="btn" id="prev-question">Soal Sebelumnya</button>
                <button class="btn" id="next-question">Soal Berikutnya</button>
            </div>
            
            <button class="btn" id="submit-test" style="margin-top: 20px; background-color: #27ae60;">Kirim Jawaban</button>
        </div>

        <!-- Halaman Hasil -->
        <div class="result-container" id="result-container">
            <h2>Hasil Tes</h2>
            <div class="score-display">
                Skor Anda: <span id="final-score">0</span>
            </div>
            
            <div class="answer-analysis" id="answer-analysis">
                <!-- Analisis jawaban akan dimuat di sini -->
            </div>
            
            <button class="btn" id="back-to-home-from-result">Kembali ke Beranda</button>
        </div>

        <!-- Panel Admin -->
        <div class="admin-panel" id="admin-panel">
            <button class="logout-btn" id="logout-admin">Logout</button>
            <h2>Panel Admin</h2>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="participant-management">Manajemen Peserta</button>
                    <button class="tab-btn" data-tab="question-management">Manajemen Soal</button>
                    <button class="tab-btn" data-tab="results-management">Hasil & Laporan</button>
                </div>
                
                <div class="tab-content active" id="participant-management">
                    <div class="admin-section">
                        <h3>Pendaftaran Peserta</h3>
                        <div class="form-group">
                            <label for="new-participant-name">Nama</label>
                            <input type="text" id="new-participant-name">
                        </div>
                        <div class="form-group">
                            <label for="new-participant-email">Email</label>
                            <input type="email" id="new-participant-email">
                        </div>
                        <div class="form-group">
                            <label for="new-participant-password">Password</label>
                            <input type="password" id="new-participant-password">
                        </div>
                        <div class="form-group">
                            <label for="new-participant-class">Kelas</label>
                            <input type="text" id="new-participant-class">
                        </div>
                        <div class="form-group">
                            <label for="new-participant-school">Asal Sekolah</label>
                            <input type="text" id="new-participant-school">
                        </div>
                        <button class="btn" id="add-participant">Tambah Peserta</button>
                    </div>
                    
                    <div class="admin-section">
                        <h3>Daftar Peserta Terdaftar</h3>
                        <table id="participants-table">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Kelas</th>
                                    <th>Sekolah</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data peserta akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="question-management">
                    <div class="admin-section">
                        <h3>Tambah Soal Baru</h3>
                        <div class="form-group">
                            <label for="question-text">Pertanyaan</label>
                            <textarea id="question-text" rows="3" style="width: 100%; padding: 12px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Opsi Jawaban</label>
                            <input type="text" id="option-a" placeholder="Opsi A">
                            <input type="text" id="option-b" placeholder="Opsi B">
                            <input type="text" id="option-c" placeholder="Opsi C">
                            <input type="text" id="option-d" placeholder="Opsi D">
                        </div>
                        <div class="form-group">
                            <label for="correct-answer">Jawaban Benar</label>
                            <select id="correct-answer">
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                            </select>
                        </div>
                        <button class="btn" id="add-question">Tambah Soal</button>
                    </div>
                    
                    <div class="admin-section">
                        <h3>Daftar Soal</h3>
                        <table id="questions-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Pertanyaan</th>
                                    <th>Jawaban Benar</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data soal akan dimuat di sini -->
                            </tbody>
                        </table>
                        
                        <button class="btn" id="publish-questions" style="margin-top: 20px; background-color: #27ae60;">Publikasikan Soal</button>
                    </div>
                </div>
                
                <div class="tab-content" id="results-management">
                    <div class="admin-section">
                        <h3>Hasil Peserta</h3>
                        <table id="results-table">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Sekolah</th>
                                    <th>Skor</th>
                                    <th>Detail</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data hasil akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data simulasi (dalam aplikasi nyata, data ini akan disimpan di database)
        let participants = JSON.parse(localStorage.getItem('participants')) || [];
        let questions = JSON.parse(localStorage.getItem('questions')) || [];
        let results = JSON.parse(localStorage.getItem('results')) || [];
        let adminAccounts = [
            { email: "admin@smplomba.id", password: "admin123" }
        ];
        
        // Elemen DOM
        const homePage = document.getElementById('home-page');
        const participantLogin = document.getElementById('participant-login');
        const adminLogin = document.getElementById('admin-login');
        const dashboard = document.getElementById('dashboard');
        const testContainer = document.getElementById('test-container');
        const resultContainer = document.getElementById('result-container');
        const adminPanel = document.getElementById('admin-panel');
        
        // Variabel state
        let currentUser = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval = null;
        let timeLeft = 120 * 60; // 120 menit dalam detik
        
        // Inisialisasi data contoh jika belum ada
        if (questions.length === 0) {
            questions = [
                {
                    id: 1,
                    text: "Berapakah hasil dari 8 × 7?",
                    options: {
                        a: "54",
                        b: "56",
                        c: "58",
                        d: "60"
                    },
                    correctAnswer: "b"
                },
                {
                    id: 2,
                    text: "Apa ibukota Indonesia?",
                    options: {
                        a: "Jakarta",
                        b: "Bandung",
                        c: "Surabaya",
                        d: "Medan"
                    },
                    correctAnswer: "a"
                },
                {
                    id: 3,
                    text: "Planet terdekat dari matahari adalah?",
                    options: {
                        a: "Venus",
                        b: "Bumi",
                        c: "Mars",
                        d: "Merkurius"
                    },
                    correctAnswer: "d"
                }
            ];
            localStorage.setItem('questions', JSON.stringify(questions));
        }
        
        // Event Listeners
        document.getElementById('participant-login-btn').addEventListener('click', () => {
            homePage.style.display = 'none';
            participantLogin.style.display = 'block';
        });
        
        document.getElementById('admin-login-btn').addEventListener('click', () => {
            homePage.style.display = 'none';
            adminLogin.style.display = 'block';
        });
        
        document.getElementById('back-to-home').addEventListener('click', () => {
            participantLogin.style.display = 'none';
            homePage.style.display = 'block';
        });
        
        document.getElementById('back-to-home-admin').addEventListener('click', () => {
            adminLogin.style.display = 'none';
            homePage.style.display = 'block';
        });
        
        document.getElementById('participant-login-submit').addEventListener('click', () => {
            const email = document.getElementById('participant-email').value;
            const password = document.getElementById('participant-password').value;
            const name = document.getElementById('participant-name').value;
            
            const participant = participants.find(p => p.email === email && p.password === password && p.name === name);
            
            if (participant) {
                currentUser = participant;
                participantLogin.style.display = 'none';
                dashboard.style.display = 'block';
                
                // Isi profil pengguna
                document.getElementById('profile-name').textContent = participant.name;
                document.getElementById('profile-email').textContent = participant.email;
                document.getElementById('profile-class').textContent = participant.class;
                document.getElementById('profile-school').textContent = participant.school;
            } else {
                alert('Email, nama, atau password salah. Silakan coba lagi.');
            }
        });
        
        document.getElementById('admin-login-submit').addEventListener('click', () => {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            const admin = adminAccounts.find(a => a.email === email && a.password === password);
            
            if (admin) {
                adminLogin.style.display = 'none';
                adminPanel.style.display = 'block';
                loadParticipantsTable();
                loadQuestionsTable();
                loadResultsTable();
            } else {
                alert('Email atau password admin salah.');
            }
        });
        
        document.getElementById('start-test').addEventListener('click', () => {
            dashboard.style.display = 'none';
            testContainer.style.display = 'block';
            
            // Inisialisasi jawaban user
            userAnswers = new Array(questions.length).fill(null);
            
            // Load soal pertama
            loadQuestion(0);
            
            // Mulai timer
            startTimer();
        });
        
        document.getElementById('submit-test').addEventListener('click', () => {
            if (confirm('Apakah Anda yakin ingin mengirim jawaban? Setelah dikirim, Anda tidak dapat mengubahnya.')) {
                clearInterval(timerInterval);
                calculateScore();
                testContainer.style.display = 'none';
                resultContainer.style.display = 'block';
            }
        });
        
        document.getElementById('back-to-home-from-result').addEventListener('click', () => {
            resultContainer.style.display = 'none';
            homePage.style.display = 'block';
            currentUser = null;
        });
        
        document.getElementById('logout-participant').addEventListener('click', () => {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                if (timerInterval) clearInterval(timerInterval);
                dashboard.style.display = 'none';
                homePage.style.display = 'block';
                currentUser = null;
            }
        });
        
        document.getElementById('logout-during-test').addEventListener('click', () => {
            if (confirm('Apakah Anda yakin ingin logout? Semua jawaban yang telah diisi akan hilang.')) {
                clearInterval(timerInterval);
                testContainer.style.display = 'none';
                homePage.style.display = 'block';
                currentUser = null;
            }
        });
        
        document.getElementById('logout-admin').addEventListener('click', () => {
            adminPanel.style.display = 'none';
            homePage.style.display = 'block';
        });
        
        document.getElementById('prev-question').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                saveAnswer();
                loadQuestion(currentQuestionIndex - 1);
            }
        });
        
        document.getElementById('next-question').addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                saveAnswer();
                loadQuestion(currentQuestionIndex + 1);
            }
        });
        
        document.getElementById('add-participant').addEventListener('click', () => {
            const name = document.getElementById('new-participant-name').value;
            const email = document.getElementById('new-participant-email').value;
            const password = document.getElementById('new-participant-password').value;
            const classVal = document.getElementById('new-participant-class').value;
            const school = document.getElementById('new-participant-school').value;
            
            if (name && email && password && classVal && school) {
                participants.push({
                    name,
                    email,
                    password,
                    class: classVal,
                    school
                });
                
                localStorage.setItem('participants', JSON.stringify(participants));
                loadParticipantsTable();
                
                // Reset form
                document.getElementById('new-participant-name').value = '';
                document.getElementById('new-participant-email').value = '';
                document.getElementById('new-participant-password').value = '';
                document.getElementById('new-participant-class').value = '';
                document.getElementById('new-participant-school').value = '';
                
                alert('Peserta berhasil ditambahkan.');
            } else {
                alert('Harap isi semua field.');
            }
        });
        
        document.getElementById('add-question').addEventListener('click', () => {
            const text = document.getElementById('question-text').value;
            const optionA = document.getElementById('option-a').value;
            const optionB = document.getElementById('option-b').value;
            const optionC = document.getElementById('option-c').value;
            const optionD = document.getElementById('option-d').value;
            const correctAnswer = document.getElementById('correct-answer').value;
            
            if (text && optionA && optionB && optionC && optionD) {
                questions.push({
                    id: questions.length + 1,
                    text,
                    options: {
                        a: optionA,
                        b: optionB,
                        c: optionC,
                        d: optionD
                    },
                    correctAnswer
                });
                
                localStorage.setItem('questions', JSON.stringify(questions));
                loadQuestionsTable();
                
                // Reset form
                document.getElementById('question-text').value = '';
                document.getElementById('option-a').value = '';
                document.getElementById('option-b').value = '';
                document.getElementById('option-c').value = '';
                document.getElementById('option-d').value = '';
                
                alert('Soal berhasil ditambahkan.');
            } else {
                alert('Harap isi semua field.');
            }
        });
        
        document.getElementById('publish-questions').addEventListener('click', () => {
            if (questions.length > 0) {
                alert('Soal telah dipublikasikan dan siap untuk digunakan peserta.');
            } else {
                alert('Tidak ada soal untuk dipublikasikan. Silakan tambahkan soal terlebih dahulu.');
            }
        });
        
        // Tab functionality untuk admin panel
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and content
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });
        
        // Fungsi bantuan
        function loadQuestion(index) {
            currentQuestionIndex = index;
            const question = questions[index];
            
            const questionsContainer = document.getElementById('questions-container');
            questionsContainer.innerHTML = `
                <div class="question">
                    <h3>Soal ${index + 1} dari ${questions.length}</h3>
                    <p>${question.text}</p>
                    <div class="options">
                        <div class="option">
                            <input type="radio" id="option-a" name="answer" value="a" ${userAnswers[index] === 'a' ? 'checked' : ''}>
                            <label for="option-a">A. ${question.options.a}</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="option-b" name="answer" value="b" ${userAnswers[index] === 'b' ? 'checked' : ''}>
                            <label for="option-b">B. ${question.options.b}</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="option-c" name="answer" value="c" ${userAnswers[index] === 'c' ? 'checked' : ''}>
                            <label for="option-c">C. ${question.options.c}</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="option-d" name="answer" value="d" ${userAnswers[index] === 'd' ? 'checked' : ''}>
                            <label for="option-d">D. ${question.options.d}</label>
                        </div>
                    </div>
                </div>
            `;
            
            // Tambahkan event listener untuk radio buttons
            document.querySelectorAll('input[name="answer"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    userAnswers[index] = e.target.value;
                });
            });
            
            // Update status navigasi tombol
            document.getElementById('prev-question').disabled = index === 0;
            document.getElementById('next-question').disabled = index === questions.length - 1;
        }
        
        function saveAnswer() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            if (selectedOption) {
                userAnswers[currentQuestionIndex] = selectedOption.value;
            }
        }
        
        function startTimer() {
            timeLeft = 120 * 60; // 120 menit
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('Waktu telah habis! Jawaban akan dikirim otomatis.');
                    calculateScore();
                    testContainer.style.display = 'none';
                    resultContainer.style.display = 'block';
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `Waktu tersisa: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Ubah warna menjadi merah ketika waktu hampir habis
            if (timeLeft < 300) { // 5 menit
                document.getElementById('timer').style.backgroundColor = '#e74c3c';
            }
        }
        
        function calculateScore() {
            let score = 0;
            let correctAnswers = 0;
            let wrongAnswers = 0;
            let unanswered = 0;
            
            const answerAnalysis = document.getElementById('answer-analysis');
            answerAnalysis.innerHTML = '<h3>Analisis Jawaban</h3>';
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;
                
                if (userAnswer === null) {
                    unanswered++;
                } else if (isCorrect) {
                    score += 2;
                    correctAnswers++;
                } else {
                    score -= 1;
                    wrongAnswers++;
                }
                
                // Tambahkan analisis per soal
                const answerDiv = document.createElement('div');
                answerDiv.classList.add('question-analysis');
                answerDiv.innerHTML = `
                    <p><strong>Soal ${index + 1}:</strong> ${question.text}</p>
                    <p class="${isCorrect ? 'correct' : 'incorrect'}">Jawaban Anda: ${userAnswer ? userAnswer.toUpperCase() : 'Tidak dijawab'} ${userAnswer ? `(${question.options[userAnswer]})` : ''}</p>
                    <p class="correct">Jawaban Benar: ${question.correctAnswer.toUpperCase()} (${question.options[question.correctAnswer]})</p>
                    <hr>
                `;
                answerAnalysis.appendChild(answerDiv);
            });
            
            // Simpan hasil
            if (currentUser) {
                results.push({
                    participant: currentUser.email,
                    name: currentUser.name,
                    school: currentUser.school,
                    score,
                    correctAnswers,
                    wrongAnswers,
                    unanswered,
                    answers: userAnswers
                });
                
                localStorage.setItem('results', JSON.stringify(results));
            }
            
            // Tampilkan skor
            document.getElementById('final-score').textContent = score;
        }
        
        function loadParticipantsTable() {
            const tableBody = document.querySelector('#participants-table tbody');
            tableBody.innerHTML = '';
            
            participants.forEach(participant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${participant.name}</td>
                    <td>${participant.email}</td>
                    <td>${participant.class}</td>
                    <td>${participant.school}</td>
                    <td>
                        <button class="btn" style="padding: 5px; background-color: #e74c3c;" onclick="deleteParticipant('${participant.email}')">Hapus</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function loadQuestionsTable() {
            const tableBody = document.querySelector('#questions-table tbody');
            tableBody.innerHTML = '';
            
            questions.forEach((question, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${question.text}</td>
                    <td>${question.correctAnswer.toUpperCase()}</td>
                    <td>
                        <button class="btn" style="padding: 5px; background-color: #e74c3c;" onclick="deleteQuestion(${index})">Hapus</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function loadResultsTable() {
            const tableBody = document.querySelector('#results-table tbody');
            tableBody.innerHTML = '';
            
            // Urutkan hasil berdasarkan skor (tertinggi ke terendah)
            const sortedResults = [...results].sort((a, b) => b.score - a.score);
            
            sortedResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.name}</td>
                    <td>${result.participant}</td>
                    <td>${result.school}</td>
                    <td>${result.score}</td>
                    <td>
                        <button class="btn" style="padding: 5px;" onclick="viewResultDetails('${result.participant}')">Lihat Detail</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Fungsi global untuk diakses dari onclick
        window.deleteParticipant = function(email) {
            if (confirm('Apakah Anda yakin ingin menghapus peserta ini?')) {
                participants = participants.filter(p => p.email !== email);
                localStorage.setItem('participants', JSON.stringify(participants));
                loadParticipantsTable();
            }
        };
        
        window.deleteQuestion = function(index) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                questions.splice(index, 1);
                localStorage.setItem('questions', JSON.stringify(questions));
                loadQuestionsTable();
            }
        };
        
        window.viewResultDetails = function(email) {
            const result = results.find(r => r.participant === email);
            if (result) {
                let details = `Detail Hasil untuk ${result.name}:\n`;
                details += `Skor: ${result.score}\n`;
                details += `Jawaban Benar: ${result.correctAnswers}\n`;
                details += `Jawaban Salah: ${result.wrongAnswers}\n`;
                details += `Tidak Dijawab: ${result.unanswered}\n\n`;
                
                questions.forEach((question, index) => {
                    const userAnswer = result.answers[index];
                    details += `Soal ${index + 1}: ${userAnswer ? userAnswer.toUpperCase() : 'Tidak dijawab'}\n`;
                });
                
                alert(details);
            }
        };
    </script>
</body>
</html>
